#!/bin/bash
set -euo pipefail

bin="$(dirname "$0")"
base="$(realpath --relative-to . "$bin/..")"

dst_local="$(mktemp -t cumulate-cases-XXXXXX.tsv)"

trap "rm -f '$dst_local'" EXIT

# Fetch US cases counts from NYTimes repo (cumulative counts)
curl 'https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-states.csv' \
    --fail --silent --show-error \
    --header 'User-Agent: https://github.com/nextstrain/counts (hello@nextstrain.org)' > "$dst_local"

# Calculate daily case counts from the cumulative counts
# Only keeps rows that have more than 0 cases
"$bin"/cumulative-to-new-cases \
    --cumulative-cases "$dst_local"
